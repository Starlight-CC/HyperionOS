local dblib={}
local fs=require("filesystem")

local function t2t(tabl)
    local output = "{"
    for i,v in pairs(tabl) do
        local coma=true
        if type(i) == "string" then
            output=output.."[\""..i.."\"]="
        end
        if type(v) == "table" then
            if v == tabl then
                output=string.sub(output,1,#output-(#i+1))
                coma=false
            else
                output=output..t2t(v)
            end
        elseif type(v) == "string" then
            output=output.."[=["..v.."]=]"
        elseif type(v) == "number" then
            output=output..tostring(v)
        elseif type(v) == "boolean" then
            if v == true then
                output=output.."true"
            else
                output=output.."false"
            end
        else
            error("Cannot serialize data of type "..type(v))
        end
        if coma then
            output=output..","
        end
    end
    if #table>0 or string.sub(output,#output,#output) == "," then
        output=string.sub(output,1,#output-1)
    end
    output=output.."}"
    return output
end

function dblib.make(path)
    local dbfile=fs.open(path,"rc")
    if string.sub(dbfile, 1, 7)~="hyperdb" then
        error("This is not a hyperdb file")
    end
    local db=string.split(dbfile, "\n")
    for i,v in ipairs(db) do
        if v=="hyperdb" then
            db[i]=nil
        else
            db[i]=load("return "..v)()
        end
    end
    
    return {
        get=function(x,y)
            return db[y][x]
        end,
        set=function(x,y,data)
            if type(data)==
            db[y][x]=data
            if db[y][x] == data then
                
            end
        end
    }
end